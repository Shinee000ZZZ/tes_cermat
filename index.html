<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Tes Kecermatan</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-6 rounded shadow-lg max-w-md w-full" id="quiz-container">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">Tes Kecermatan</h1>
            <div id="timer" class="text-xl font-semibold text-gray-700">01:00</div>
        </div>

        <h2 id="soal-label" class="text-lg font-bold text-center mb-2"></h2>

        <div id="kolom-utama" class="grid grid-cols-5 gap-4 mb-2"></div>
        <div id="kolom-label" class="grid grid-cols-5 gap-4 mb-4"></div>

        <div id="kolom-kedua" class="grid grid-cols-4 gap-4 mb-4"></div>
        <div class="text-center font-semibold mb-4">Pilih huruf yang hilang:</div>
        <div id="pilihan-jawaban" class="grid grid-cols-5 gap-4"></div>
        <p id="feedback" class="text-center font-bold mt-4"></p>
        <button id="reset-button" class="mt-4 px-6 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600"
            style="display: none;">
            Reset Quiz
        </button>
    </div>

    <script>
        let detik = 0;
        let currentQuestion = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let unansweredQuestions = 0; // Menyimpan soal yang tidak terjawab
        let questions = [];
        let timerInterval;
        let countdown;

        function acakHuruf(jumlah) {
            const huruf = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            let hasil = [];
            while (hasil.length < jumlah) {
                const randomHuruf = huruf[Math.floor(Math.random() * huruf.length)];
                if (!hasil.includes(randomHuruf)) hasil.push(randomHuruf);
            }
            return hasil;
        }

        function acakArray(arr) {
            return arr
                .map((value) => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);
        }

        function buatSoal() {
            for (let i = 0; i < 30; i++) {
                let kolomUtama = acakHuruf(5);
                let hilangIndex = Math.floor(Math.random() * 5);
                let hurufYangHilang = kolomUtama[hilangIndex];
                let kolomKedua = [...kolomUtama];
                kolomKedua[hilangIndex] = "";
                questions.push({ kolomUtama, kolomKedua, hurufYangHilang });
            }
        }

        function tampilkanKolom(id, data, acak = false) {
            const elemen = document.getElementById(id);
            const isi = acak ? acakArray(data) : data;
            elemen.innerHTML = isi
                .filter((h) => h !== "") // Menghapus data kosong
                .map((h) =>
                    `<div class="p-4 bg-gray-200 text-center font-bold text-xl">${h}</div>`
                ).join('');
        }

        function tampilkanLabel(id) {
            const elemen = document.getElementById(id);
            elemen.innerHTML = ["A", "B", "C", "D", "E"].map((l) =>
                `<div class="p-2 text-center text-lg font-bold">${l}</div>`
            ).join('');
        }

        function tampilkanPilihan(id, hurufYangHilang) {
            const elemen = document.getElementById(id);
            elemen.innerHTML = ["A", "B", "C", "D", "E"].map((l, index) =>
                `<button onclick="pilihHuruf('${hurufYangHilang}', '${questions[currentQuestion].kolomUtama[index]}')" class="p-4 bg-gray-300 text-center font-bold text-xl cursor-pointer hover:bg-gray-400">${l}</button>`
            ).join('');
        }

        function tampilkanSoal() {
            if (currentQuestion >= questions.length) {
                clearInterval(timerInterval);
                document.getElementById("quiz-container").innerHTML = `
                    <h2 class="text-xl font-bold text-center mb-4">Hasil Akhir</h2>
                    <p class="text-center text-lg">Jawaban Benar: ${correctAnswers}</p>
                    <p class="text-center text-lg">Jawaban Salah: ${wrongAnswers}</p>
                    <p class="text-center text-lg">Soal Tidak Terjawab: ${unansweredQuestions}</p>
                    <button onclick="resetQuiz()" class="mt-4 px-6 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600">
                        Reset Quiz
                    </button>
                `;
                return;
            }

            const { kolomUtama, kolomKedua, hurufYangHilang } = questions[currentQuestion];
            document.getElementById("soal-label").textContent = `Soal ${currentQuestion + 1}`;
            tampilkanKolom("kolom-utama", kolomUtama);
            tampilkanLabel("kolom-label");
            tampilkanKolom("kolom-kedua", kolomKedua, true); // Acak kolom kedua
            tampilkanPilihan("pilihan-jawaban", hurufYangHilang);
            startTimer();
        }

        function startTimer() {
            detik = 30; // 1 menit
            updateTimerDisplay();
            if (countdown) { // Cek jika ada interval yang berjalan
                clearInterval(countdown); // Hentikan interval yang sebelumnya
            }
            countdown = setInterval(() => {
                detik--;
                updateTimerDisplay();
                if (detik < 0) {
                    unansweredQuestions++; // Jika waktu habis dan soal belum terjawab
                    clearInterval(countdown);
                    currentQuestion++;
                    tampilkanSoal();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const menit = String(Math.floor(detik / 60)).padStart(2, "0");
            const detikFormat = String(detik % 60).padStart(2, "0");
            document.getElementById("timer").textContent = `${menit}:${detikFormat}`;
        }

        function pilihHuruf(jawabanBenar, jawabanPilih) {
            const feedback = document.getElementById("feedback");
            if (jawabanBenar === jawabanPilih) {
                correctAnswers++;
                feedback.textContent = `Benar!`;
                feedback.className = "text-green-500";
            } else {
                wrongAnswers++;
                feedback.textContent = `Salah! Coba lagi.`;
                feedback.className = "text-red-500";
            }
            currentQuestion++;
            setTimeout(() => {
                feedback.textContent = "";
                tampilkanSoal();
            }, 1000);
        }

        function resetQuiz() {
            window.location.reload(); // Refresh halaman untuk reset quiz
        }

        buatSoal();
        tampilkanSoal();
    </script>
</body>

</html>